<!DOCTYPE html> 
<html>
    <head>
        <meta charset="UTF-8">
        <link href=resources/css/labsBlog.css rel=stylesheet>
        <title>TiRaMiSu CAKE</title>
    </head>
    <body>
        <div theme="blog">
            <section class="maincontainer">
                <div class="container is-page">
                    <header class="navigation-header">
                        <section class="top-links">
                            <a href="index.html">Home</a><p>|</p>
                        </section>
                    </header>
                    <header class="notification-header">
                    </header>
                    <div class="blog-post">
                        <img src="image/blog/posts/1.jpg">
                        <h1>I Wanted A Bike</h1>
                        <p><span id=blog-author>Carrie Atune</span> | 28 June 2024</p>
                        <hr>
                        <p>When it comes the holidays more and more people are finding it hard to make ends meet. They turn to Social Media and ask for advice, how they can make Christmas magical for their little ones when they don&apos;t have any spare money. So many kind humanitarians reassure them that time is the best gift they can give their kids, a day of fun-filled frolicking.</p>
                        <p>I didn&apos;t want to spend the day with my parents watching movies and eating chocolate. I wanted a bike. Not having money, and not buying me a bike does make you a rubbish parent regardless of what all the nosey parker do-gooders tell you. They say it is all about &apos;making memories&apos;, well that sucks, I&apos;ll NEVER forget the Christmas I didn&apos;t get that bike, how&apos;s that for making memories.</p>
                        <p>Why do all these people dishing out their meaningless platitudes think that families want to spend the day trapped in the house together, it&apos;s not like we even have any old relatives to visit and brighten up the proceedings with a snort and inappropriate passing of wind during dinner. You want to keep me trapped like a prisoner in the house all day and make memories, then you should have bought me that bike.</p>
                        <div>
                            <hr>
                            <h1>Comments</h1>
                            <span id='user-comments'>
                                <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.0.15/purify.min.js"></script>
                                <script src='resources/js/loadComments.js'></script>
                                <section class="comment">
                                    <p>
                                        Mike Groin | 21-07-2024
                                        <div>
                                            <img class="avatar" src="resources/images/avatarDefault.png">
                                        </div>
                                    </p>
                                    <p>I cannot believe how many people disagree on the internet!</p>
                                    <p></p>
                                </section>
                            </span>
                        <hr>
                        <section class="add-comment">
                            <h2>Leave a comment</h2>
                            <form id="commentForm">
                                <input required type="hidden" name="csrf" value="N6xOiYmiK8fc0QVFSBJe947MloJpnKkL">
                                <input required type="hidden" name="postId" value="1">
                                <label>Comment:</label>
                                <div>HTML is allowed</div>
                                <textarea required rows="12" cols="300" name="comment"></textarea>
                                        <label>Name:</label>
                                        <input required type="text" name="name">
                                        <label>Email:</label>
                                        <input required type="email" name="email">
                                        <label>Website:</label>
                                        <input pattern="(http:|https:).+" type="text" name="website">
                                <button class="button" type="submit">Post Comment</button>
                            </form>
                        </section>
                        <div class="is-linkback">
                            <a href="index.html">Back to Blog</a>
                        </div>
                    </div>
                </div>
            </section>
            <div class="footer-wrapper">
            </div>
        </div>
        <script> // 댓글 등록 및 로드 과정 자동화 
            document.getElementById('commentForm').addEventListener('submit', function(e) {
                e.preventDefault(); // 기본 폼 제출을 막음 (새로고침 방지)
    
                let formData = new FormData(this);
    
                fetch('post/post_comment.php', { // 댓글 등록 시 post_comment.php로 보내져 댓글이 comments.json에 저장됨
                    method: 'POST',
                    body: formData
                }).then(response => response.text()).then(data => {
                    loadComments('post/get_comments.php');
                }).catch(error => console.error('Error:', error));
            });
            
            // 댓글이 로드될 때는 get_comments.php를 통해 comments.json에서 데이터를 불러옴 
            window.onload = function() {
                loadComments('post/get_comments.php');
            };

            // (XSS injection) onerror 삽입으로 flag 불러오기
            function displayFlag() {
                fetch('flag.txt')
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('flag-container').innerText = data;
                    })
                    .catch(error => console.error('Error fetching the flag:', error));
            }
        </script>
    </body>
</html>
